[gd_scene load_steps=30 format=3 uid="uid://divk0ab7tgtd0"]

[ext_resource type="Script" path="res://scripts/handle_pixelation.gd" id="1_g8fm3"]
[ext_resource type="PackedScene" uid="uid://bylwa0aplfyax" path="res://scenes/player.tscn" id="1_ywxjf"]
[ext_resource type="Texture2D" uid="uid://g146hua62ocj" path="res://assets/lukkys textures/hand_painted_grass.png" id="3_tjny0"]
[ext_resource type="PackedScene" uid="uid://decyj3xqmljig" path="res://scenes/props/barrel.tscn" id="4_4cap6"]
[ext_resource type="PackedScene" uid="uid://bvs1xcg0yjlxv" path="res://scenes/props/crate.tscn" id="5_d76mp"]
[ext_resource type="Script" path="res://scripts/npc/scheduler.gd" id="6_6askm"]
[ext_resource type="Texture2D" uid="uid://dkosm7bkxnj7o" path="res://assets/blue_nebulae_1.png" id="6_vqehm"]
[ext_resource type="Script" path="res://scripts/npc/npc.gd" id="7_80dul"]
[ext_resource type="Script" path="res://scripts/npc/emotions.gd" id="8_a4n64"]
[ext_resource type="Script" path="res://scripts/npc/home.gd" id="8_jn8p6"]
[ext_resource type="Script" path="res://scripts/npc/personality.gd" id="9_cj51m"]
[ext_resource type="Script" path="res://scripts/npc/job.gd" id="9_ex4b4"]
[ext_resource type="Script" path="res://scripts/npc/landmark.gd" id="11_octe2"]

[sub_resource type="BoxShape3D" id="BoxShape3D_7h77l"]
size = Vector3(75, 1, 75)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_fwulq"]
albedo_texture = ExtResource("3_tjny0")
uv1_scale = Vector3(0.4, 0.4, 0.4)
uv1_triplanar = true

[sub_resource type="PlaneMesh" id="PlaneMesh_ip3kr"]
material = SubResource("StandardMaterial3D_fwulq")
size = Vector2(75, 75)

[sub_resource type="NavigationMesh" id="NavigationMesh_t33e6"]
vertices = PackedVector3Array(-37.0222, 0.392384, -1.94941, -5.77222, 0.392384, -1.94941, -5.52222, 0.392384, -3.69941, -4.27222, 0.392384, -4.19941, -4.27222, 0.392384, -37.1994, -37.0222, 0.392384, -37.1994, -3.27222, 0.392384, -3.94941, 4.47778, 0.392384, -5.19941, 4.47778, 0.392384, -6.94941, 6.47778, 0.392384, -37.1994, 6.72778, 0.392384, -7.19941, 7.72778, 0.392384, -6.94941, 7.72778, 0.392384, -5.94941, 36.9778, 0.392384, -5.94941, 36.9778, 0.392384, -37.1994, 7.22778, 0.392384, 2.05059, 7.72778, 0.392384, 3.05059, 8.47778, 0.392384, 3.05059, 7.47778, 0.392384, -3.94941, 6.47778, 0.392384, -3.44941, 6.47778, 0.392384, 2.05059, 8.72778, 0.392384, 4.05059, 36.9778, 0.392384, 4.05059, 5.72778, 0.392384, -3.44941, 5.47778, 0.392384, 2.80059, -2.27222, 0.392384, -1.44941, -3.02222, 0.392384, -0.949409, -2.27222, 0.392384, -2.94941, -4.02222, 1.89238, -2.94941, -4.52222, 1.89238, -2.94941, -4.77222, 1.89238, -2.19941, -4.77222, 1.89238, -1.69941, -3.27222, 1.89238, -1.94941, 4.47778, 0.392384, 4.55059, 4.47778, 0.392384, 6.30059, -5.52222, 0.392384, -0.699409, 5.97778, 0.392384, 36.8006, -37.0222, 0.392384, 36.8006, 5.97778, 0.392384, 6.80059, 8.22778, 0.392384, 5.30059, 6.97778, 0.392384, 5.30059, 6.72778, 0.392384, 6.55059, 36.9778, 0.392384, 36.8006)
polygons = [PackedInt32Array(2, 1, 0), PackedInt32Array(2, 0, 3), PackedInt32Array(3, 0, 4), PackedInt32Array(4, 0, 5), PackedInt32Array(8, 7, 6), PackedInt32Array(6, 3, 8), PackedInt32Array(8, 3, 4), PackedInt32Array(8, 4, 9), PackedInt32Array(9, 10, 8), PackedInt32Array(13, 12, 11), PackedInt32Array(11, 10, 13), PackedInt32Array(13, 10, 9), PackedInt32Array(13, 9, 14), PackedInt32Array(16, 15, 17), PackedInt32Array(17, 15, 19), PackedInt32Array(17, 19, 18), PackedInt32Array(15, 20, 19), PackedInt32Array(17, 18, 21), PackedInt32Array(21, 18, 12), PackedInt32Array(21, 12, 22), PackedInt32Array(22, 12, 13), PackedInt32Array(23, 19, 20), PackedInt32Array(20, 24, 23), PackedInt32Array(23, 24, 7), PackedInt32Array(7, 24, 25), PackedInt32Array(25, 24, 26), PackedInt32Array(27, 6, 7), PackedInt32Array(25, 27, 7), PackedInt32Array(29, 28, 30), PackedInt32Array(30, 28, 31), PackedInt32Array(31, 28, 32), PackedInt32Array(26, 24, 33), PackedInt32Array(33, 34, 26), PackedInt32Array(26, 34, 35), PackedInt32Array(34, 36, 35), PackedInt32Array(35, 36, 0), PackedInt32Array(0, 36, 37), PackedInt32Array(34, 38, 36), PackedInt32Array(0, 1, 35), PackedInt32Array(41, 40, 39), PackedInt32Array(39, 21, 22), PackedInt32Array(36, 38, 41), PackedInt32Array(39, 22, 41), PackedInt32Array(41, 22, 36), PackedInt32Array(36, 22, 42)]

[sub_resource type="PhysicalSkyMaterial" id="PhysicalSkyMaterial_pwylq"]
turbidity = 0.0
ground_color = Color(0.294793, 0.227868, 0.147204, 1)
energy_multiplier = 1.18
night_sky = ExtResource("6_vqehm")

[sub_resource type="Sky" id="Sky_wkxqu"]
sky_material = SubResource("PhysicalSkyMaterial_pwylq")

[sub_resource type="Environment" id="Environment_xso02"]
background_mode = 2
background_energy_multiplier = 2.25
sky = SubResource("Sky_wkxqu")
ambient_light_source = 3
tonemap_mode = 2
tonemap_exposure = 0.9
tonemap_white = 1.45
ssao_radius = 1.8
ssao_intensity = 2.5
ssao_power = 2.35375
glow_enabled = true
glow_normalized = true
glow_bloom = 0.1
adjustment_enabled = true
adjustment_contrast = 0.87
adjustment_saturation = 1.21

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_372vt"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_rkigc"]
albedo_color = Color(0, 0.693455, 0.60667, 1)

[sub_resource type="CapsuleMesh" id="CapsuleMesh_kmggu"]
material = SubResource("StandardMaterial3D_rkigc")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_rijab"]
albedo_color = Color(0.293485, 0.352648, 1, 1)

[sub_resource type="SphereMesh" id="SphereMesh_0suxt"]
material = SubResource("StandardMaterial3D_rijab")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_vdso1"]
albedo_color = Color(0.858904, 0, 0.160098, 1)

[sub_resource type="SphereMesh" id="SphereMesh_abj4j"]
material = SubResource("StandardMaterial3D_vdso1")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_34hwy"]
albedo_color = Color(0.534753, 0.796901, 1.15514e-06, 1)

[sub_resource type="SphereMesh" id="SphereMesh_ejm8f"]
material = SubResource("StandardMaterial3D_34hwy")

[node name="Main" type="Node"]

[node name="SubViewportContainer" type="SubViewportContainer" parent="."]
texture_filter = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
stretch = true
stretch_shrink = 5
script = ExtResource("1_g8fm3")

[node name="SubViewport" type="SubViewport" parent="SubViewportContainer"]
handle_input_locally = false
size = Vector2i(200, 125)
render_target_update_mode = 4

[node name="Player" parent="SubViewportContainer/SubViewport" instance=ExtResource("1_ywxjf")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.67426, 0)
walk_speed = 3.0
run_speed = 15.0

[node name="Ground" type="StaticBody3D" parent="SubViewportContainer/SubViewport"]

[node name="Ground CollisionShape3D" type="CollisionShape3D" parent="SubViewportContainer/SubViewport/Ground"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.539104, 0)
shape = SubResource("BoxShape3D_7h77l")

[node name="Ground Botoom Inverted" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/Ground"]
transform = Transform3D(1, 0, 0, 0, -1, 8.74228e-08, 0, -8.74228e-08, -1, -0.0252132, -0.870062, 0.00361061)
mesh = SubResource("PlaneMesh_ip3kr")
skeleton = NodePath("../NavigationRegion3D")

[node name="NavigationRegion3D" type="NavigationRegion3D" parent="SubViewportContainer/SubViewport/Ground"]
transform = Transform3D(0.998237, 0, 0, 0, 0.998237, 0, 0, 0, 0.998237, -0.0252132, -4.76837e-07, 0.00361061)
navigation_mesh = SubResource("NavigationMesh_t33e6")

[node name="Obstacles" type="Node3D" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.0832579, 0)

[node name="barrel" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("4_4cap6")]
transform = Transform3D(1.4325, 0, 0.0247292, 0, 1.43271, 0, -0.0247292, 0, 1.4325, -3.50812, 0, -2.18966)

[node name="barrel2" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("4_4cap6")]
transform = Transform3D(1.43271, 0, 0, 0, 1.43271, 0, 0, 0, 1.43271, -4.64089, 0, -1.85844)

[node name="barrel5" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("4_4cap6")]
transform = Transform3D(1.43271, 0, 0, 0, 1.43271, 0, 0, 0, 1.43271, 6.59368, 0, 3.27875)

[node name="barrel4" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("4_4cap6")]
transform = Transform3D(1.43271, 0, 0, 0, 1.43271, 0, 0, 0, 1.43271, 6.58978, 0, -6.0063)

[node name="barrel3" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("4_4cap6")]
transform = Transform3D(1.43271, 0, 0, 0, 1.43271, 0, 0, 0, 1.43271, -4.27544, -0.0529132, -2.93333)

[node name="crate" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("5_d76mp")]
transform = Transform3D(0.964026, 0, 0.265808, 0, 1, 0, -0.265808, 0, 0.964026, 6.35588, 9.53674e-07, -4.77352)

[node name="crate3" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("5_d76mp")]
transform = Transform3D(0.997597, 0, -0.0692864, 0, 1, 0, 0.0692864, 0, 0.997597, 5.65414, 9.53674e-07, 5.52138)

[node name="crate4" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("5_d76mp")]
transform = Transform3D(0.941206, 0, -0.337835, 0, 1, 0, 0.337835, 0, 0.941206, 6.10795, 9.53674e-07, 4.45124)

[node name="crate5" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("5_d76mp")]
transform = Transform3D(0.941206, 0, -0.337835, 0, 1, 0, 0.337835, 0, 0.941206, 7.48576, 9.53674e-07, 4.1531)

[node name="crate2" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D/Obstacles" instance=ExtResource("5_d76mp")]
transform = Transform3D(0.988268, 0, 0.152727, 0, 1, 0, -0.152727, 0, 0.988268, 5.49786, 0.00691527, -5.77781)

[node name="Ground Mesh" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/Ground/NavigationRegion3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.0222254, -0.107616, -0.199408)
mesh = SubResource("PlaneMesh_ip3kr")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="SubViewportContainer/SubViewport"]
transform = Transform3D(0.896574, -0.11613, -0.427398, 0.442861, 0.22326, 0.868348, -0.00542101, -0.967817, 0.251596, 0, 0, 0)
shadow_enabled = true

[node name="WorldEnvironment" type="WorldEnvironment" parent="SubViewportContainer/SubViewport"]
environment = SubResource("Environment_xso02")

[node name="NPCs" type="Node" parent="SubViewportContainer/SubViewport"]

[node name="NPC-SMART" type="CharacterBody3D" parent="SubViewportContainer/SubViewport/NPCs" node_paths=PackedStringArray("emotions", "personality", "job", "home", "points_of_interest")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3.23009, 1.27432, 5.31106)
script = ExtResource("7_80dul")
npc_name = "NPC_37"
current_age = 25
emotions = NodePath("Emotions")
personality = NodePath("Personality")
job = NodePath("../../Targets/WORK")
home = NodePath("../../Targets/HOME")
points_of_interest = [NodePath("../../Targets/POI")]

[node name="Emotions" type="Node" parent="SubViewportContainer/SubViewport/NPCs/NPC-SMART"]
script = ExtResource("8_a4n64")
go_to_job_thresshold = 0.86
go_to_home_thresshold = 0.72
job_late_importance = 0.56
home_late_importance = 0.62
home_love = 0.6
job_love = 0.55

[node name="Personality" type="Node" parent="SubViewportContainer/SubViewport/NPCs/NPC-SMART"]
script = ExtResource("9_cj51m")
aggression = 0.4
loyalty = 0.8
bravery = 0.5
chaos = 0.3
energy = 0.7
body = 0.6
mind = 0.7
soul = 0.8

[node name="CollisionShape3D" type="CollisionShape3D" parent="SubViewportContainer/SubViewport/NPCs/NPC-SMART"]
shape = SubResource("CapsuleShape3D_372vt")

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/NPCs/NPC-SMART"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.00998974, -0.0188441, -0.00345898)
mesh = SubResource("CapsuleMesh_kmggu")

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="SubViewportContainer/SubViewport/NPCs/NPC-SMART"]

[node name="Targets" type="Node3D" parent="SubViewportContainer/SubViewport"]

[node name="HOME" type="Node3D" parent="SubViewportContainer/SubViewport/Targets"]
transform = Transform3D(1.39495, 0, 0, 0, 1.39495, 0, 0, 0, 1.39495, -0.620317, 0.133089, 15.5366)
script = ExtResource("8_jn8p6")
expected_home_time = 8.0
time_want_to_arrive = 20.0
max_lateness = 2.0
landmark_name = "Home"

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/Targets/HOME"]
mesh = SubResource("SphereMesh_0suxt")

[node name="OmniLight3D" type="OmniLight3D" parent="SubViewportContainer/SubViewport/Targets/HOME"]
transform = Transform3D(0.716872, 0, 0, 0, 0.716872, 0, 0, 0, 0.716872, 0, 1.57619, 0)
light_color = Color(4.62055e-06, 0.720069, 0.970503, 1)
light_energy = 4.75
shadow_enabled = true
omni_range = 5.73
omni_attenuation = 0.375

[node name="POI" type="Node3D" parent="SubViewportContainer/SubViewport/Targets"]
transform = Transform3D(1.39495, 0, 0, 0, 1.39495, 0, 0, 0, 1.39495, -6.276, 0.133089, -4.60975)
script = ExtResource("11_octe2")
landmark_name = "Test Landmark"

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/Targets/POI"]
mesh = SubResource("SphereMesh_abj4j")

[node name="OmniLight3D" type="OmniLight3D" parent="SubViewportContainer/SubViewport/Targets/POI"]
transform = Transform3D(0.716872, 0, 0, 0, 0.716872, 0, 0, 0, 0.716872, 0, 1.57619, 0)
light_color = Color(1, 0.47973, 0.467837, 1)
light_energy = 4.75
shadow_enabled = true
omni_range = 5.73
omni_attenuation = 0.375

[node name="WORK" type="Node3D" parent="SubViewportContainer/SubViewport/Targets"]
transform = Transform3D(1.39495, 0, 0, 0, 1.39495, 0, 0, 0, 1.39495, 6.43425, 0.133088, -7.53322)
script = ExtResource("9_ex4b4")
expected_work_time = 8.0
min_work_time_accepted = 0.9
time_want_to_arrive = 10.0
max_lateness = 1.0
max_worker_distance = 10.0
landmark_name = "Work"

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/Targets/WORK"]
mesh = SubResource("SphereMesh_ejm8f")

[node name="OmniLight3D2" type="OmniLight3D" parent="SubViewportContainer/SubViewport/Targets/WORK"]
transform = Transform3D(0.716872, 0, 0, 0, 0.716872, 0, 0, 0, 0.716872, 0, 1.576, 0)
light_color = Color(0, 0.800927, 0.184589, 1)
light_energy = 4.75
shadow_enabled = true
omni_range = 5.73
omni_attenuation = 0.375

[node name="Node" type="Node" parent="SubViewportContainer/SubViewport"]

[node name="OmniLight3D" type="OmniLight3D" parent="SubViewportContainer/SubViewport/Node"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 6.61151, 2.99291, 3.95771)
light_energy = 5.133
shadow_enabled = true
omni_range = 7.648
omni_attenuation = 0.765

[node name="OmniLight3D2" type="OmniLight3D" parent="SubViewportContainer/SubViewport/Node"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.75829, 2.99291, -2.10811)
light_energy = 5.133
shadow_enabled = true
omni_range = 7.648
omni_attenuation = 0.765

[node name="OmniLight3D3" type="OmniLight3D" parent="SubViewportContainer/SubViewport/Node"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 6.54987, 2.99291, -5.15791)
light_energy = 5.133
shadow_enabled = true
omni_range = 7.648
omni_attenuation = 0.765

[node name="Scheduler" type="Timer" parent="." node_paths=PackedStringArray("sun", "npc_holder")]
script = ExtResource("6_6askm")
full_day_time = 60.0
sun = NodePath("../SubViewportContainer/SubViewport/DirectionalLight3D")
npc_holder = NodePath("../SubViewportContainer/SubViewport/NPCs")
